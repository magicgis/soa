-- DROP TABLE SOA_GOV.TBL_SOA_APP_INFO;
CREATE TABLE SOA_GOV.TBL_SOA_APP_INFO (
  APP_NAME          VARCHAR(64) NOT NULL,
  APP_TITLE         VARCHAR(200),
  APP_DESC          VARCHAR(2048),
  AUTH_NEEDED       INTEGER DEFAULT 0,
  ROLE              VARCHAR(16),
  STATUS            VARCHAR(16),
  ADDRESS_COUNT     INTEGER,
  DEP_APP_COUNT     INTEGER,
  DEP_BY_APP_COUNT  INTEGER,
  EXP_SERVICE_COUNT INTEGER,
  REF_SERVICE_COUNT INTEGER,
  DOC_PATH          VARCHAR(200),
  JAVADOC           VARCHAR(200),
  CREATE_DATE       TIMESTAMP,
  LAST_MODIFY_DATE  TIMESTAMP,
  CONSTRAINT "P_KEY_1" PRIMARY KEY (APP_NAME)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_APP_INFO IS '应用信息';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.APP_NAME IS '应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.APP_TITLE IS '应用标题';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.APP_DESC IS '应用描述';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.AUTH_NEEDED IS '是否需授权';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.ROLE IS '角色';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.STATUS IS '状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.ADDRESS_COUNT IS '机器数量';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.DEP_APP_COUNT IS '依赖系统数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.DEP_BY_APP_COUNT IS '被引用数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.EXP_SERVICE_COUNT IS '暴露服务数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.REF_SERVICE_COUNT IS '依赖服务数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.DOC_PATH IS '外部文档路径';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.JAVADOC IS 'JAVADOC';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_INFO.LAST_MODIFY_DATE IS '最后修改日';

-- DROP TABLE SOA_GOV.TBL_SOA_APP_DEPENDENCY;
CREATE TABLE SOA_GOV.TBL_SOA_APP_DEPENDENCY (
  ID               BIGINT      NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  APP_NAME         VARCHAR(64) NOT NULL,
  DEP_APP_NAME     VARCHAR(64) NOT NULL,
  AUTH_STATUS      VARCHAR(16),
  CREATE_DATE      TIMESTAMP,
  LAST_MODIFY_DATE TIMESTAMP,
  CONSTRAINT APP_DEPENDENCY_UKEY UNIQUE (APP_NAME, DEP_APP_NAME),
  CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_APP_DEPENDENCY IS '应用依赖';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.APP_NAME IS '应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.DEP_APP_NAME IS '依赖应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.AUTH_STATUS IS '授权状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_DEPENDENCY.LAST_MODIFY_DATE IS '最后修改日';

CREATE INDEX SOA_GOV.TBL_SOA_APP_DEPENDENCY_APP_NAME ON SOA_GOV.TBL_SOA_APP_DEPENDENCY (APP_NAME ASC);
CREATE INDEX SOA_GOV.TBL_SOA_APP_DEPENDENCY_DEP_APP_NAME ON SOA_GOV.TBL_SOA_APP_DEPENDENCY (DEP_APP_NAME ASC);


-- DROP TABLE SOA_GOV.TBL_SOA_APP_UPGRADE_INFO;
CREATE TABLE SOA_GOV.TBL_SOA_APP_UPGRADE_INFO (
  ID               BIGINT      NOT NULL NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  APP_NAME         VARCHAR(64) NOT NULL,
  UPGRADE_INFO     VARCHAR(1024),
  CREATE_DATE      TIMESTAMP,
  LAST_MODIFY_DATE TIMESTAMP,
  CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_APP_UPGRADE_INFO IS '应用升级信息';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_UPGRADE_INFO.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_UPGRADE_INFO.APP_NAME IS '应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_UPGRADE_INFO.UPGRADE_INFO IS '升级信息';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_UPGRADE_INFO.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_UPGRADE_INFO.LAST_MODIFY_DATE IS '最后修改日';

CREATE INDEX SOA_GOV.TBL_SOA_APP_UPGRADE_INFO_APP_NAME ON SOA_GOV.TBL_SOA_APP_UPGRADE_INFO (APP_NAME ASC);


-- DROP TABLE SOA_GOV.TBL_SOA_APP_OWNER;
CREATE TABLE SOA_GOV.TBL_SOA_APP_OWNER (
  ID          BIGINT      NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  APP_NAME    VARCHAR(64) NOT NULL,
  LOGIN_NAME  VARCHAR(64) NOT NULL,
  OWNER_NAME  VARCHAR(64) NOT NULL,
  CREATE_DATE TIMESTAMP,
  CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_APP_OWNER IS '应用负责人';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_OWNER.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_OWNER.APP_NAME IS '应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_OWNER.LOGIN_NAME IS '后台登录名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_OWNER.OWNER_NAME IS '用户名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_OWNER.CREATE_DATE IS '创建日期';

CREATE INDEX SOA_GOV.TBL_SOA_APP_OWNER_APP_NAME ON SOA_GOV.TBL_SOA_APP_OWNER (APP_NAME ASC);
CREATE INDEX SOA_GOV.TBL_SOA_APP_OWNER_LOGIN_NAME ON SOA_GOV.TBL_SOA_APP_OWNER (LOGIN_NAME ASC);


-- DROP TABLE SOA_GOV.TBL_SOA_SERVICE_INFO;
CREATE TABLE SOA_GOV.TBL_SOA_SERVICE_INFO (
  ID                        BIGINT       NOT NULL NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  APP_NAME                  VARCHAR(64)  NOT NULL,
  SERVICE_INTERFACE         VARCHAR(200) NOT NULL,
  SERVICE_INTERFACE_LOWCASE VARCHAR(200) NOT NULL UNIQUE,
  SERVICE_NAME              VARCHAR(200),
  SERVICE_DESC              VARCHAR(2048),
  SERVICE_PROTOCOL          VARCHAR(32),
  SERVICE_SIGN              VARCHAR(64),
  PROVIDER_COUNT            INTEGER,
  CONSUMER_COUNT            INTEGER,
  STATUS                    VARCHAR(16),
  CREATE_DATE               TIMESTAMP,
  LAST_MODIFY_DATE          TIMESTAMP,
  CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_SERVICE_INFO IS '服务信息';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.APP_NAME IS '应用名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_INTERFACE IS '服务接口';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_INTERFACE_LOWCASE IS '服务接口';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_NAME IS '服务名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_DESC IS '服务描述';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_PROTOCOL IS '服务协议';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.SERVICE_SIGN IS '服务签名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.PROVIDER_COUNT IS '提供者数量';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.CONSUMER_COUNT IS '消费者数量';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.STATUS IS '状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_SERVICE_INFO.LAST_MODIFY_DATE IS '最后更新日期';

CREATE INDEX SOA_GOV.TBL_SOA_SERVICE_INFO_APP_NAME ON SOA_GOV.TBL_SOA_SERVICE_INFO (APP_NAME ASC);
CREATE INDEX SOA_GOV.TBL_SOA_SERVICE_INFO_SERVICE_INTERFACE ON SOA_GOV.TBL_SOA_SERVICE_INFO (SERVICE_INTERFACE ASC);


-- DROP TABLE SOA_GOV.TBL_SOA_METHOD_INFO;
CREATE TABLE SOA_GOV.TBL_SOA_METHOD_INFO (
  ID               BIGINT       NOT NULL NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  SERVICE_ID       BIGINT       NOT NULL,
  METHOD_NAME      VARCHAR(200) NOT NULL,
  METHOD_DESC      VARCHAR(1000),
  METHOD_SIGN      VARCHAR(64),
  STATUS           VARCHAR(16),
  CREATE_DATE      TIMESTAMP,
  LAST_MODIFY_DATE TIMESTAMP,
  CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_METHOD_INFO IS '服务详情';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.SERVICE_ID IS '服务ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.METHOD_NAME IS '方法名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.METHOD_DESC IS '方法描述';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.METHOD_SIGN IS '方法签名';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.STATUS IS '状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_METHOD_INFO.LAST_MODIFY_DATE IS '最后更新日期';

CREATE INDEX SOA_GOV.TBL_SOA_METHOD_INFO_SERVICE_ID ON SOA_GOV.TBL_SOA_METHOD_INFO (SERVICE_ID ASC);

-------------
-- 监控数据 --
-------------
DROP TABLE SOA_GOV.TBL_SOA_MONITOR_DATA;
CREATE TABLE SOA_GOV.TBL_SOA_MONITOR_DATA
(
  ID             BIGINT PRIMARY KEY NOT NULL
  GENERATED BY DEFAULT AS IDENTITY,
  DATESTR        VARCHAR(8)         NOT NULL,
  SERVICE        VARCHAR(200)       NOT NULL,
  METHOD         VARCHAR(200)       NOT NULL,
  TYPE           VARCHAR(20)        NOT NULL,
  CONSUMER       VARCHAR(16)        NOT NULL DEFAULT '0.0.0.0',
  PROVIDER       VARCHAR(16)        NOT NULL DEFAULT '0.0.0.0',
  SUCCESS        BIGINT             NOT NULL DEFAULT 0,
  FAILURE        BIGINT             NOT NULL DEFAULT 0,
  ELAPSED        BIGINT             NOT NULL DEFAULT 0,
  CONCURRENT     BIGINT             NOT NULL DEFAULT 0,
  MAX_ELAPSED    BIGINT             NOT NULL DEFAULT 0,
  MAX_CONCURRENT BIGINT             NOT NULL DEFAULT 0,
  CREATE_DATE    TIMESTAMP
)PARTITION BY RANGE(CREATE_DATE) 
(STARTING MINVALUE, STARTING '2014-10-01' ENDING '2018-12-31' EVERY 1 MONTH);

COMMENT ON TABLE SOA_GOV.TBL_SOA_MONITOR_DATA IS '监控数据';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.ID IS '编号';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.DATESTR IS '时间';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.SERVICE IS '服务名称';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.METHOD IS '方法名称';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.TYPE IS '数据来源';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.CONSUMER IS '消费者IP';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.PROVIDER IS '生产者IP';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.SUCCESS IS '调用成功次数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.FAILURE IS '调用失败次数';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.ELAPSED IS '调用时长';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.CONCURRENT IS '并发';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.MAX_ELAPSED IS '最大调用时长';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_MONITOR_DATA.MAX_CONCURRENT IS '最大并发';

CREATE INDEX SOA_GOV.MONITOR_DATA_DATESTR_index ON SOA_GOV.TBL_SOA_MONITOR_DATA (DATESTR DESC);
CREATE INDEX SOA_GOV.SERVICE_METHOD_TYPE_index ON SOA_GOV.TBL_SOA_MONITOR_DATA (SERVICE, METHOD, TYPE);

DROP TABLE SOA_GOV.TBL_SOA_ADDRESS;
CREATE TABLE SOA_GOV.TBL_SOA_ADDRESS (
    ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
    ADDRESS VARCHAR(64) NOT NULL,
    ENVIRONMENT VARCHAR(10),
    STATUS VARCHAR(16),
    ROLE VARCHAR(16),
    CREATE_DATE TIMESTAMP,
    LAST_MODIFY_DATE TIMESTAMP,
    CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_ADDRESS IS '机器信息';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.ADDRESS IS 'IP地址';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.ENVIRONMENT IS '环境';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.STATUS IS '状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.ROLE IS '运行时角色';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_ADDRESS.LAST_MODIFY_DATE IS '最后修改日';

CREATE INDEX SOA_GOV.TBL_SOA_ADDRESS_ADDRESS ON SOA_GOV.TBL_SOA_ADDRESS(ADDRESS ASC);


DROP TABLE SOA_GOV.TBL_SOA_NETWORK;
CREATE TABLE SOA_GOV.TBL_SOA_NETWORK (
    ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
    CONSUMER VARCHAR(64) NOT NULL,
    PROVIDER VARCHAR(64) NOT NULL,
    STATUS VARCHAR(16),
    CREATE_DATE TIMESTAMP,
    LAST_MODIFY_DATE TIMESTAMP,
    CONSTRAINT NET_STATUS_UKEY UNIQUE (CONSUMER,PROVIDER),CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_NETWORK IS '网络状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.CONSUMER IS '消费者';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.PROVIDER IS '提供者';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.STATUS IS '状态';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.CREATE_DATE IS '创建日期';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_NETWORK.LAST_MODIFY_DATE IS '最后修改日';

CREATE INDEX SOA_GOV.TBL_SOA_NETWORK_CONSUMER ON SOA_GOV.TBL_SOA_NETWORK(CONSUMER ASC);
CREATE INDEX SOA_GOV.TBL_SOA_NETWORK_PROVIDER ON SOA_GOV.TBL_SOA_NETWORK(PROVIDER ASC);

DROP TABLE SOA_GOV.TBL_SOA_APP_ADDRESS;
CREATE TABLE SOA_GOV.TBL_SOA_APP_ADDRESS (
    ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
    ADDRESS VARCHAR(64) NOT NULL,
    APP_NAME VARCHAR(64) NOT NULL,
    CONSTRAINT APP_ADDRESS_UKEY UNIQUE (ADDRESS,APP_NAME),CONSTRAINT "P_KEY_1" PRIMARY KEY (ID)
);

COMMENT ON TABLE SOA_GOV.TBL_SOA_APP_ADDRESS IS '机器应用关系';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_ADDRESS.ID IS 'ID';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_ADDRESS.ADDRESS IS 'IP地址';
COMMENT ON COLUMN SOA_GOV.TBL_SOA_APP_ADDRESS.APP_NAME IS '应用名';
